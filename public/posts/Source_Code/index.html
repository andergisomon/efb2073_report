<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Source code | Volintine Ander, Zechariah Hwong, Kensley Kudang, Aziz Abdul Bagas, Eddry Haqimy Yusri</title>
<meta name=keywords content><meta name=description content="View our code in detail"><meta name=author content="Volintine Ander, Zechariah Hwong, Kensley Kudang, Aziz Abdul Bagas, Eddry Haqimy Yusri"><link rel=canonical href=http://localhost:1313/posts/source_code/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.59770712f52a9d7223fa72e79480fcf8a406e4124d5cc0e1ce1e947e9ee463c6.css integrity="sha256-WXcHEvUqnXIj+nLnlID8+KQG5BJNXMDhzh6Ufp7kY8Y=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/source_code/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Source code"><meta property="og:description" content="View our code in detail"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/source_code/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="og:site_name" content="EFB2073 Project Report"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Source code"><meta name=twitter:description content="View our code in detail"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Source code","item":"http://localhost:1313/posts/source_code/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Source code","name":"Source code","description":"View our code in detail","keywords":[],"articleBody":"The source code for this web report is available here\r. Source code for the ESP32C3 boards are available here\r.\nTransmitter program 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 #include \"esp_log.h\" #include \"esp_system.h\" #include \"freertos/FreeRTOS.h\" #include \"freertos/timers.h\" #include \"esp_wifi.h\" #include \"esp_mac.h\" #include \"espnow_utils.h\" #include \"espnow.h\" #include \"espnow_ctrl.h\" #include \"driver/gpio.h\" #include \"espnow_mem.h\" // #include \"build/config/sdkconfig.h\" // Posuango popianai do intellisense nopo, pokinomio' pogulu mamaal /* Include only to shut up intellisense nagging */ #define KOTOS_1 2 // GPIO2, D0 id dulak / on the board #define KOTOS_2 3 // GPIO3, D1 id dulak / on the board #define KOTOS_3 4 // GPIO4, D2 id dulak / on the board int prev1 = 0; int prev2 = 0; int prev3 = 0; int current1 = 0; int current2 = 0; int current3 = 0; uint8_t pagatadan[] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF}; // Broadcast mode address static const char *TAG = \"sodusuhu\"; typedef struct gamit { int buttonstate1; int buttonstate2; int buttonstate3; int buttonstate4; int buttonstate5; int buttonstate6; } gamit; gamit dolinon; // Mamadalin do poiloon id pampos Poniasan / For transfering data to transmitter function static void ponimpuun_wifi() { esp_event_loop_create_default(); wifi_init_config_t cfg = WIFI_INIT_CONFIG_DEFAULT(); ESP_ERROR_CHECK(esp_wifi_init(\u0026cfg)); ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_STA)); ESP_ERROR_CHECK(esp_wifi_set_storage(WIFI_STORAGE_RAM)); ESP_ERROR_CHECK(esp_wifi_set_ps(WIFI_PS_NONE)); ESP_ERROR_CHECK(esp_wifi_start()); } // Initialize read pins static void ponimpuun_pomiri(void) { gpio_reset_pin(KOTOS_1); gpio_reset_pin(KOTOS_2); gpio_reset_pin(KOTOS_3); /* Tolu GPIO hiti nopo nga' pinisok / Three of these GPIO are buttons */ gpio_set_direction(KOTOS_1, GPIO_MODE_INPUT); gpio_set_direction(KOTOS_2, GPIO_MODE_INPUT); gpio_set_direction(KOTOS_3, GPIO_MODE_INPUT); } // Function for reading GPIO pipns static void pomiri(void) { current1 = gpio_get_level(KOTOS_1); current2 = gpio_get_level(KOTOS_2); current3 = gpio_get_level(KOTOS_3); if (prev1 == 0 \u0026\u0026 current1 == 1) { dolinon.buttonstate1 = 1; } else { dolinon.buttonstate1 = 0; } if (prev2 == 0 \u0026\u0026 current2 == 1) { dolinon.buttonstate2 = 1; } else { dolinon.buttonstate2 = 0; } if (prev3 == 0 \u0026\u0026 current3 == 1) { dolinon.buttonstate3 = 1; } else { dolinon.buttonstate3 = 0; } } static void poniasan(void *arg) { esp_err_t sinuli = ESP_OK; while (1) { pomiri(); vTaskDelay(50 / portTICK_PERIOD_MS); esp_now_send(pagatadan, (uint8_t *) \u0026dolinon, sizeof(dolinon)); printf(\"\\n%i\\n\", sinuli); printf(\"Switch 1: %d\", dolinon.buttonstate1); printf(\"Switch 2: %d\", dolinon.buttonstate2); printf(\"Switch 3: %d\", dolinon.buttonstate3); prev1 = current1; prev2 = current2; prev3 = current3; vTaskDelay(100 / portTICK_PERIOD_MS); } ESP_LOGI(TAG, \"Poniasan nakalabus / Transmission exited\"); vTaskDelete(NULL); } static void ponimpuun_ponias(void) { xTaskCreate(poniasan, \"Popotimpuun ponias / Initialize transmitter\", 4 * 1024, NULL, tskIDLE_PRIORITY + 1, NULL); } void app_main(void) { ponimpuun_pomiri(); espnow_storage_init(); ponimpuun_ponias(); ponimpuun_wifi(); espnow_config_t espnow_config = ESPNOW_INIT_CONFIG_DEFAULT(); espnow_init(\u0026espnow_config); } Receiver program 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 #include \"esp_log.h\" #include \"esp_system.h\" #include \"freertos/FreeRTOS.h\" #include \"freertos/timers.h\" #include \"esp_wifi.h\" #include \"esp_mac.h\" #include \"espnow_utils.h\" #include \"espnow.h\" #include \"espnow_ctrl.h\" #include \"driver/gpio.h\" #include \"espnow_mem.h\" #include // Montok hiza / for time //#include \"build/config/sdkconfig.h\" // Posuango popianai do intellisense nopo, pokinomio' pogulu mamaal /* Only to silence intellisense nagging, comment before building */ #define KOTOS_1 2 // GPIO2, D0 id dulak / on board #define KOTOS_2 3 // GPIO3, D1 id dulak / on board #define KOTOS_3 4 // GPIO4, D2 id dulak / on board #define BIRI_1 5 // GPIO5, D3 id dulak / on board #define BIRI_2 6 // GPIO6, D4 id dulak / on board #define BIRI_3 7 // GPIO7, D5 id dulak / on board typedef struct gamit { int buttonstate1; int buttonstate2; int buttonstate3; int buttonstate4; int buttonstate5; int buttonstate6; } gamit; gamit dolinon; // Mamadalin do poiloon id pampos Koromitan / For transferring data to Receiving function static const char *TAG = \"sodusuhu\"; void set_time(void) { struct timeval now; now.tv_sec = 1722541840; // Seconds since Unix epoch / Kiop tantad tinontok Unix now.tv_usec = 0; settimeofday(\u0026now, NULL); } char* get_time(void) { time_t t = time(NULL); struct tm *tm = localtime(\u0026t); return asctime(tm); } static void ponimpuun_wifi() // WiFi init { esp_event_loop_create_default(); wifi_init_config_t cfg = WIFI_INIT_CONFIG_DEFAULT(); ESP_ERROR_CHECK(esp_wifi_init(\u0026cfg)); ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_STA)); ESP_ERROR_CHECK(esp_wifi_set_storage(WIFI_STORAGE_RAM)); ESP_ERROR_CHECK(esp_wifi_set_ps(WIFI_PS_NONE)); ESP_ERROR_CHECK(esp_wifi_start()); } static void ponimpuun_kotos(void) { gpio_reset_pin(KOTOS_1); gpio_reset_pin(KOTOS_2); gpio_reset_pin(KOTOS_3); /* Tolu GPIO hiti nopo nga' pinisok / These three GPIOs are buttons */ gpio_set_direction(KOTOS_1, GPIO_MODE_OUTPUT); gpio_set_direction(KOTOS_2, GPIO_MODE_OUTPUT); gpio_set_direction(KOTOS_3, GPIO_MODE_OUTPUT); /* GPIO pomiri don tikid GPIO pinisok / Reader GPIOs for each GPIO buttons */ gpio_set_direction(BIRI_1, GPIO_MODE_INPUT); gpio_set_direction(BIRI_2, GPIO_MODE_INPUT); gpio_set_direction(BIRI_3, GPIO_MODE_INPUT); gpio_set_level(KOTOS_1, 0); gpio_set_level(KOTOS_2, 0); gpio_set_level(KOTOS_3, 0); } void Koromitan(const uint8_t *pagatadan, const uint8_t *poiloon_mikot, int ninaru) { memcpy(\u0026dolinon, poiloon_mikot, sizeof(dolinon)); if (dolinon.buttonstate1 == 1) { gpio_set_level(KOTOS_1, !gpio_get_level(BIRI_1)); ESP_LOGI(TAG, \"Button 1 signal received at: %s\", get_time()); } if (dolinon.buttonstate2 == 1) { gpio_set_level(KOTOS_2, !gpio_get_level(BIRI_2)); ESP_LOGI(TAG, \"Button 2 signal received at: %s\", get_time()); } if (dolinon.buttonstate3 == 1) { gpio_set_level(KOTOS_3, !gpio_get_level(BIRI_3)); ESP_LOGI(TAG, \"Button 3 signal received at: %s\", get_time()); } } void app_main(void) { for (int i = 0; i \u003c 1; i++) { ponimpuun_kotos(); set_time(); } espnow_storage_init(); ponimpuun_wifi(); espnow_config_t espnow_config = ESPNOW_INIT_CONFIG_DEFAULT(); espnow_init(\u0026espnow_config); ESP_ERROR_CHECK(esp_now_register_recv_cb(Koromitan)); ESP_LOGI(TAG, \"Receive callback registered\"); } Data logging The logging functionality requires a Powershell instance using the IDF frontend: 1 2 PS cd /path/to/idf/project PS idf.py -p COMX monitor \u003e logfile.txt The log contents can be viewed as such: 1 PS Get-Content .\\logfile.txt ","wordCount":"1040","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":[{"@type":"Person","name":"Volintine Ander"},{"@type":"Person","name":"Zechariah Hwong"},{"@type":"Person","name":"Kensley Kudang"},{"@type":"Person","name":"Aziz Abdul Bagas"},{"@type":"Person","name":"Eddry Haqimy Yusri"}],"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/source_code/"},"publisher":{"@type":"Organization","name":"Volintine Ander, Zechariah Hwong, Kensley Kudang, Aziz Abdul Bagas, Eddry Haqimy Yusri","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="EFB2073 Project Report (Alt + H)">EFB2073 Project Report</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://github.com/andergisomon/efb2073_report title="Website source"><span>Website source</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Source code</h1><div class=post-meta></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#transmitter-program>Transmitter program</a></li><li><a href=#receiver-program>Receiver program</a></li><li><a href=#data-logging>Data logging</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>The source code for this web report is available <a href=https://github.com/andergisomon/efb2073_report title=Title target=_blank>here</a>
. Source code for the ESP32C3 boards are available <a href=https://github.com/andergisomon/esp-idf-learning/ title=Title target=_blank>here</a>
.</p><h3 id=transmitter-program>Transmitter program<a hidden class=anchor aria-hidden=true href=#transmitter-program>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_log.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_system.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;freertos/FreeRTOS.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;freertos/timers.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_wifi.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_mac.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow_utils.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow_ctrl.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;driver/gpio.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow_mem.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>// #include &#34;build/config/sdkconfig.h&#34; // Posuango popianai do intellisense nopo, pokinomio&#39; pogulu mamaal
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cm>/* Include only to shut up intellisense nagging */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define KOTOS_1        2 </span><span class=c1>// GPIO2, D0 id dulak / on the board
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define KOTOS_2        3 </span><span class=c1>// GPIO3, D1 id dulak / on the board
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define KOTOS_3        4 </span><span class=c1>// GPIO4, D2 id dulak / on the board
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>prev1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=kt>int</span> <span class=n>prev2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=kt>int</span> <span class=n>prev3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>current1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=kt>int</span> <span class=n>current2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=kt>int</span> <span class=n>current3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>uint8_t</span> <span class=n>pagatadan</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xFF</span><span class=p>};</span> <span class=c1>// Broadcast mode address
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>TAG</span> <span class=o>=</span> <span class=s>&#34;sodusuhu&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=n>gamit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>gamit</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>gamit</span> <span class=n>dolinon</span><span class=p>;</span> <span class=c1>// Mamadalin do poiloon id pampos Poniasan / For transfering data to transmitter function
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ponimpuun_wifi</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>esp_event_loop_create_default</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>wifi_init_config_t</span> <span class=n>cfg</span> <span class=o>=</span> <span class=nf>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_set_storage</span><span class=p>(</span><span class=n>WIFI_STORAGE_RAM</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_set_ps</span><span class=p>(</span><span class=n>WIFI_PS_NONE</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_start</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Initialize read pins
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=kt>void</span> <span class=nf>ponimpuun_pomiri</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_reset_pin</span><span class=p>(</span><span class=n>KOTOS_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_reset_pin</span><span class=p>(</span><span class=n>KOTOS_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_reset_pin</span><span class=p>(</span><span class=n>KOTOS_3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Tolu GPIO hiti nopo nga&#39; pinisok / Three of these GPIO are buttons */</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>KOTOS_1</span><span class=p>,</span> <span class=n>GPIO_MODE_INPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>KOTOS_2</span><span class=p>,</span> <span class=n>GPIO_MODE_INPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>KOTOS_3</span><span class=p>,</span> <span class=n>GPIO_MODE_INPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Function for reading GPIO pipns
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=kt>void</span> <span class=nf>pomiri</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>current1</span> <span class=o>=</span> <span class=nf>gpio_get_level</span><span class=p>(</span><span class=n>KOTOS_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>current2</span> <span class=o>=</span> <span class=nf>gpio_get_level</span><span class=p>(</span><span class=n>KOTOS_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>current3</span> <span class=o>=</span> <span class=nf>gpio_get_level</span><span class=p>(</span><span class=n>KOTOS_3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>prev1</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>current1</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate1</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>    
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>prev2</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>current2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate2</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>    
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>prev3</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>current3</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate3</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>    
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate3</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>poniasan</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>esp_err_t</span> <span class=n>sinuli</span>  <span class=o>=</span> <span class=n>ESP_OK</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>pomiri</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nf>vTaskDelay</span><span class=p>(</span><span class=mi>50</span> <span class=o>/</span> <span class=n>portTICK_PERIOD_MS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>esp_now_send</span><span class=p>(</span><span class=n>pagatadan</span><span class=p>,</span> <span class=p>(</span><span class=kt>uint8_t</span> <span class=o>*</span><span class=p>)</span> <span class=o>&amp;</span><span class=n>dolinon</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>dolinon</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>%i</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>sinuli</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Switch 1: %d&#34;</span><span class=p>,</span> <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Switch 2: %d&#34;</span><span class=p>,</span> <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Switch 3: %d&#34;</span><span class=p>,</span> <span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>prev1</span> <span class=o>=</span> <span class=n>current1</span><span class=p>;</span> <span class=n>prev2</span> <span class=o>=</span> <span class=n>current2</span><span class=p>;</span> <span class=n>prev3</span> <span class=o>=</span> <span class=n>current3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>vTaskDelay</span><span class=p>(</span><span class=mi>100</span> <span class=o>/</span> <span class=n>portTICK_PERIOD_MS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&#34;Poniasan nakalabus / Transmission exited&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>vTaskDelete</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ponimpuun_ponias</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>xTaskCreate</span><span class=p>(</span><span class=n>poniasan</span><span class=p>,</span> <span class=s>&#34;Popotimpuun ponias / Initialize transmitter&#34;</span><span class=p>,</span> <span class=mi>4</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>tskIDLE_PRIORITY</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>ponimpuun_pomiri</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>espnow_storage_init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>ponimpuun_ponias</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>ponimpuun_wifi</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>espnow_config_t</span> <span class=n>espnow_config</span> <span class=o>=</span> <span class=nf>ESPNOW_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>espnow_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>espnow_config</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=receiver-program>Receiver program<a hidden class=anchor aria-hidden=true href=#receiver-program>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_log.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_system.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;freertos/FreeRTOS.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;freertos/timers.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_wifi.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;esp_mac.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow_utils.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow_ctrl.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;driver/gpio.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;espnow_mem.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/time.h&gt; // Montok hiza / for time</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>//#include &#34;build/config/sdkconfig.h&#34; // Posuango popianai do intellisense nopo, pokinomio&#39; pogulu mamaal
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cm>/* Only to silence intellisense nagging, comment before building */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define KOTOS_1        2 </span><span class=c1>// GPIO2, D0 id dulak / on board
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define KOTOS_2        3 </span><span class=c1>// GPIO3, D1 id dulak / on board
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define KOTOS_3        4 </span><span class=c1>// GPIO4, D2 id dulak / on board
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>#define BIRI_1         5 </span><span class=c1>// GPIO5, D3 id dulak / on board
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define BIRI_2         6 </span><span class=c1>// GPIO6, D4 id dulak / on board
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define BIRI_3         7 </span><span class=c1>// GPIO7, D5 id dulak / on board
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=n>gamit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>buttonstate6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>gamit</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>gamit</span> <span class=n>dolinon</span><span class=p>;</span> <span class=c1>// Mamadalin do poiloon id pampos Koromitan / For transferring data to Receiving function
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>TAG</span> <span class=o>=</span> <span class=s>&#34;sodusuhu&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>set_time</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>timeval</span> <span class=n>now</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>now</span><span class=p>.</span><span class=n>tv_sec</span> <span class=o>=</span> <span class=mi>1722541840</span><span class=p>;</span> <span class=c1>// Seconds since Unix epoch / Kiop tantad tinontok Unix
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>now</span><span class=p>.</span><span class=n>tv_usec</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>settimeofday</span><span class=p>(</span><span class=o>&amp;</span><span class=n>now</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>char</span><span class=o>*</span> <span class=nf>get_time</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>time_t</span> <span class=n>t</span> <span class=o>=</span> <span class=nf>time</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tm</span> <span class=o>*</span><span class=n>tm</span> <span class=o>=</span> <span class=nf>localtime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>asctime</span><span class=p>(</span><span class=n>tm</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ponimpuun_wifi</span><span class=p>()</span> <span class=c1>// WiFi init
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>esp_event_loop_create_default</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>wifi_init_config_t</span> <span class=n>cfg</span> <span class=o>=</span> <span class=nf>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_set_storage</span><span class=p>(</span><span class=n>WIFI_STORAGE_RAM</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_set_ps</span><span class=p>(</span><span class=n>WIFI_PS_NONE</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_wifi_start</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ponimpuun_kotos</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_reset_pin</span><span class=p>(</span><span class=n>KOTOS_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_reset_pin</span><span class=p>(</span><span class=n>KOTOS_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_reset_pin</span><span class=p>(</span><span class=n>KOTOS_3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Tolu GPIO hiti nopo nga&#39; pinisok / These three GPIOs are buttons */</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>KOTOS_1</span><span class=p>,</span> <span class=n>GPIO_MODE_OUTPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>KOTOS_2</span><span class=p>,</span> <span class=n>GPIO_MODE_OUTPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>KOTOS_3</span><span class=p>,</span> <span class=n>GPIO_MODE_OUTPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* GPIO pomiri don tikid GPIO pinisok / Reader GPIOs for each GPIO buttons */</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>BIRI_1</span><span class=p>,</span> <span class=n>GPIO_MODE_INPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>BIRI_2</span><span class=p>,</span> <span class=n>GPIO_MODE_INPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_direction</span><span class=p>(</span><span class=n>BIRI_3</span><span class=p>,</span> <span class=n>GPIO_MODE_INPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_level</span><span class=p>(</span><span class=n>KOTOS_1</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_level</span><span class=p>(</span><span class=n>KOTOS_2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>gpio_set_level</span><span class=p>(</span><span class=n>KOTOS_3</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Koromitan</span><span class=p>(</span><span class=k>const</span> <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>pagatadan</span><span class=p>,</span> <span class=k>const</span> <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>poiloon_mikot</span><span class=p>,</span> <span class=kt>int</span> <span class=n>ninaru</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>dolinon</span><span class=p>,</span> <span class=n>poiloon_mikot</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>dolinon</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate1</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>gpio_set_level</span><span class=p>(</span><span class=n>KOTOS_1</span><span class=p>,</span> <span class=o>!</span><span class=nf>gpio_get_level</span><span class=p>(</span><span class=n>BIRI_1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&#34;Button 1 signal received at: %s&#34;</span><span class=p>,</span> <span class=nf>get_time</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate2</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>gpio_set_level</span><span class=p>(</span><span class=n>KOTOS_2</span><span class=p>,</span> <span class=o>!</span><span class=nf>gpio_get_level</span><span class=p>(</span><span class=n>BIRI_2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&#34;Button 2 signal received at: %s&#34;</span><span class=p>,</span> <span class=nf>get_time</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>dolinon</span><span class=p>.</span><span class=n>buttonstate3</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>gpio_set_level</span><span class=p>(</span><span class=n>KOTOS_3</span><span class=p>,</span> <span class=o>!</span><span class=nf>gpio_get_level</span><span class=p>(</span><span class=n>BIRI_3</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&#34;Button 3 signal received at: %s&#34;</span><span class=p>,</span> <span class=nf>get_time</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>ponimpuun_kotos</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nf>set_time</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>espnow_storage_init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>ponimpuun_wifi</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>espnow_config_t</span> <span class=n>espnow_config</span> <span class=o>=</span> <span class=nf>ESPNOW_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>espnow_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>espnow_config</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_ERROR_CHECK</span><span class=p>(</span><span class=nf>esp_now_register_recv_cb</span><span class=p>(</span><span class=n>Koromitan</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&#34;Receive callback registered&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=data-logging>Data logging<a hidden class=anchor aria-hidden=true href=#data-logging>#</a></h3><p>The logging functionality requires a Powershell instance using the IDF frontend:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>PS <span class=nb>cd</span> /path/to/idf/project
</span></span><span class=line><span class=cl>PS idf.py -p COMX monitor &gt; logfile.txt</span></span></code></pre></td></tr></table></div></div></p><p>The log contents can be viewed as such:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>PS Get-Content .<span class=se>\l</span>ogfile.txt</span></span></code></pre></td></tr></table></div></div></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/results/><span class=title>« Prev</span><br><span>Project outcomes & Accomplishments</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Volintine Ander, Zechariah Hwong, Kensley Kudang, Aziz Abdul Bagas, Eddry Haqimy Yusri</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>